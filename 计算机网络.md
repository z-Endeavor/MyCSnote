# 计算机网络



## IP地址（IPv4）

IP地址由四段组成，每个字段是一个字节，8位，最大值是255。

IP地址由两部分组成，即**网络地址**和**主机地址**。

IP地址根据网络号和主机号来分，分为A、B、C三类及特殊地址D、E。  全0和全1的都保留不用。

- **A类**：(1.0.0.0-126.0.0.0)（默认子网掩码：255.0.0.0或 0xFF000000）<u>第一个字节为网络号，后三个字节为主机号</u>。该类IP地址的**最前面为“0”**，所以地址的网络号取值于1~126之间。一般用于**大型网络**。
- **B类**：(128.0.0.0-191.255.0.0)（默认子网掩码：255.255.0.0或0xFFFF0000）<u>前两个字节为网络号，后两个字节为主机号</u>。该类IP地址的**最前面为“10”**，所以地址的网络号取值于128~191之间。一般用于**中等规模网络**。
- **C类**：(192.0.0.0-223.255.255.0)（子网掩码：255.255.255.0或 0xFFFFFF00）<u>前三个字节为网络号，最后一个字节为主机号</u>。该类IP地址的**最前面为“110”**，所以地址的网络号取值于192~223之间。一般用于**小型网络**。
- **D类**：是多播地址。该类IP地址的**最前面为“1110”**，所以地址的网络号取值于224~239之间。一般用于多路广播用户[1] 。
- **E类**：是保留地址。该类IP地址的**最前面为“1111”**，所以地址的网络号取值于240~255之间。



## IPv6

#### 地址长度

IPv6的地址长度为**128位**，分成**八段**，每节包含16个地址位，采用**十六进制**表示。



## 默认路由

由于在路由表中存储针对每个主机或子网的路由项不可行，因此提出了默认路由的概念，默认路由中的网关称为默认网关。

默认路由匹配任何网络通信，因此当到达特定主机或特定子网的路由并未在路由表中指定时，均可通过默认路由来进行转发。

默认路由的网络地址为 `0.0.0.0` ，网络掩码为 `0.0.0.0` 。



## Ping

Ping命令是基于 **ICMP** 协议。

ICMP协议用来<u>检查网络是否通畅或者网络连接速度的命令</u>。



## UDP和TCP

### 用户数据报协议UDP（User Datagram Protocol）

- 无连接的，提供面向地址的传输服务
- 没有拥塞控制
- 面向报文（对于应用程序传下来的报文不合并不拆分，只添加UDP首部）
- 支持一对一、一对多、多对一和多对多的交互通信
- 首部开销较小，为8个字节

基于UDP的应用层协议：**DNS、TFTP、SNMP、NTP、DHCP**

### 传输控制协议TCP（Transmission Control Protocol）

- 面向连接的，提供可靠交付（无差错、不丢失、不重复、按序到达）
- 有流量控制、拥塞控制，提供全双工通信
- 面向字节流（应用层传下的报文看成字节流，把字节流组织成大小不等的数据块）
- 每一条TCP连接只能是点对点的（一对一）
- 首部开销20字节

基于TCP的应用层协议：**HTTP、FTP、SMTP、TELNET、SSH**

### TCP三次握手

利用客户服务器模式，连接服务器指定端口，建立TCP连接，同步连接双方的序列号和确认号，确认双方的接收能力和发送能力。

避免 两次握手 造成的**失效的连接请求报文段突然传到服务器使其资源浪费**的问题。

1. 发送端首先**发送一个带SYN**（synchronize）标志的数据包给接收方。<u>证明发送端的发送能力正常</u>。
2. 接收方收到后，**回传一个带有SYN / ACK** (acknowledegment)标志的数据包以示传达确认信息。<u>证明接收端的接收能力、发送能力正常</u>。
3. 最后发送方再**回传一个带ACK**标志的数据包，代表握手结束。<u>证明发送端的接收能力正常</u>。

> A：你好！听得到吗？
>
> B：听到了，你能听到吗？
>
> A：听到了。

### TCP四次挥手

原因：

1. 客户端发出连接释放报文，停止发送数据，**FIN=1**，序列号**seq=u**。进入<u>终止等待1状态</u>。
2. 服务端发出确认报文，**ACK=1，ack=u+1**，带上自己的序列号**seq=v**。服务端进入<u>关闭等待状态</u>。
3. 客户端接收到确认请求，进入<u>终止等待2状态</u>。服务端将最后的数据发送完后，向客户端发送连接释放报文，**FIN=1，ACK=1，seq=w，ack=u+1**，进入<u>最后确认状态</u>。
4. 客户端收到连接释放报文，发出确认，**ACK=1，ack=w+1**，序列号为**seq=u+1**，进入<u>时间等待状态</u>，经过2MSL最长报文寿命（**防止新连接出现旧连接的请求报文**），客户端进入<u>关闭状态</u>，而服务端收到确认报文后，立即进入<u>关闭状态</u>。TCP连接断开。

> A：那我先走了
>
> B：好的，那你走吧
>
> B：那我也走了？
>
> A：好的，你走吧。

### TCP可靠性机制

TCP主要提供了**检验和、序列号/确认应答、超时重传、最大消息长度、滑动窗口控制**等方法实现了可靠性传输。

#### 检验和

通过检验和的方式，接收端可以**检测出来数据是否有差错和异常**，假如有差错就会直接丢弃TCP段，重新发送。TCP在计算检验和时，会在TCP首部加上一个**12字节**的伪首部。检验和总共计算3部分：<u>TCP首部、TCP数据、TCP伪首部</u>。

#### 序列号/确认应答

发送端发送信息给接收端，接收端会回应一个包，这个包就是**应答包**。

只要发送端有一个包传输，接收端没有回应确认包（ACK包），都会重发。或者接收端的应答包，发送端没有收到也会重发数据。这就可以保证数据的完整性。

#### 超时重传

发送出去的数据包到接收到确认包之间的时间，如果超过了这个时间会被认为是丢包了，需要重传。

超时重传的时间大概是比<u>往返时间+抖动值还要稍大</u>的时间。

#### 最大消息长度

在建立TCP连接的时候，双方约定一个最大的长度（MSS）作为发送的单位，重传的时候也是以这个单位来进行重传。

理想的情况下是该长度的数据刚好不被网络层分块。

#### 滑动窗口控制

滑动窗口使得**不用等待确认包就发送下一个数据包**。

窗口的大小就是在**无需等待确认包的情况下，发送端还能发送的最大数据量**。这个机制的实现就是**使用了大量的缓冲**区，通过对多个段进行确认应答的功能。通过下一次的确认包可以判断接收端是否已经接收到了数据，如果已经接收了就从缓冲区里面删除数据。

接收端在**没有收到自己所期望的序列号数据之前，会对之前的数据进行重复确认**。发送端在收到某个应答包之后，又连续3次收到同样的应答包，则数据已经丢失了，需要重发。

#### 拥塞控制

引入**慢启动**机制，先发出少量数据，就像探路一样，先摸清当前的网络拥堵状态后，再决定按照多大的速度传送数据。

在启动**初期以指数增长**方式增长；设置一个慢启动的阈值，当以指数增长**达到阈值时就停止指数增长**，按照**线性增长**方式增加至拥塞窗口；线性增长达到网络拥塞时立即把拥塞窗口置回1，进行新一轮的“慢启动”，同时**新一轮的阈值变为原来的一半**。

### UDP可靠传输

最简单的方式是**在应用层模仿传输层TCP的可靠性传输**。

1. 添加seq/ack机制，确保数据发送到对端
2. 添加发送和接收缓冲区，主要是用户超时重传。
3. 添加超时重传机制。



## HTTP请求

**HTTP1.0**定义了三种请求方式：

- GET: 向服务器获取数据
- POST：将实体提交到指定的资源，通常会造成服务器资源的修改。
- HEAD：获取报文首部，与GET相比，不返回报文主体部分

**HTTP1.1**新增了五种请求方式：

- PUT：上传文件，修改数据
- DELETE：删除服务器上的对象
- OPTIONS：询问支持的请求方法，用来跨域请求
- TRACE：追踪 请求—响应 的传输路径
- CONNECT：要求在与代理服务器通信时建立隧道，使用隧道进行TCP通信



## HTTP状态码

#### 1. 2XX (Success 成功状态码)

状态码2XX表示请求被**正常处理**了。

- **200 OK**：表示客户端发来的请求被服务器端正常处理了。
- **204 No Content：**该状态码表示客户端发送的请求已经在服务器端正常处理了，但是没有返回的内容，响应报文中不包含实体的主体部分。 一般在只需要从客户端往服务器端发送信息，而服务器端不需要往客户端发送内容时使用。
- **206 Partial Content：**该状态码表示客户端进行了范围请求，而服务器端执行了这部分的 GET 请求。响应报文中包含由 Content-Range 指定范围的实体内容。

#### 2. 3XX (Redirection 重定向状态码)

3XX 响应结果表明浏览器**需要执行某些特殊的处理**以正确处理请求。

- **301 Moved Permanently**：**永久重定向。** 该状态码表示请求的资源已经被分配了新的 URL，以后应使用资源指定的 URL。新的 URL 会在 HTTP 响应头中的 Location 首部字段指定。 若用户已经把原来的URL保存为书签，此时会按照 Location 中新的URI重新保存该书签。 同时，搜索引擎在抓取新内容的同时也将旧的网址替换为重定向之后的网址。

  **使用场景：**

  - 当我们想换个域名，旧的域名不再使用时，用户访问旧域名时用301就重定向到新的域名。其实也是告诉搜索引擎收录的域名需要对新的域名进行收录。

  - 在搜索引擎的搜索结果中出现了不带www的域名，而带www的域名却没有收录，这个时候可以用301重定向来告诉搜索引擎我们目标的域名是哪一个。


- **302 Found：临时重定向。** 该状态码表示请求的资源被分配到了新的 URL，希望用户（本次）能使用新的 URL访问资源。 和 301 Moved Permanently 状态码相似，但是 302 代表的资源不是被永久重定向，只是临时性质的。也就是说已移动的资源对应的 URL 将来还有可能发生改变。 若用户把 URL保存成书签，但<u>不会像 301 状态码出现时那样去更新书签</u>，而是仍旧保留返回 302 状态码的页面对应的 URL。 同时，搜索引擎会抓取新的内容而保留旧的网址。因为服务器返回302代码，搜索引擎认为新的网址只是暂时的。

  **使用场景：**

  - 当我们在做活动时，登录到首页自动重定向，进入活动页面。

  - 未登陆的用户访问用户中心重定向到登录页面。

  - 访问404页面重新定向到首页。


- **303 See Other：**该状态码表示由于请求对应的资源存在着另一个 URI，应使用 GET 方法定向获取请求的资源。 303 状态码和 302 Found 状态码有着相似的功能，但是 303 状态码明确表示客户端应当采用 GET 方法获取资源。 303 状态码通常作为 PUT 或 POST 操作的返回结果，它表示重定向链接指向的不是新上传的资源，而是另外一个页面，比如消息确认页面或上传进度页面。而请求重定向页面的方法要总是使用 GET。 注意：

> 当 301、302、303 响应状态码返回时，几乎所有的浏览器都会把 POST 改成GET，并删除请求报文内的主体，之后请求会再次自动发送。 301、302 标准是禁止将 POST 方法变成 GET方法的，但实际大家都会这么做。

- **304 Not Modified：浏览器缓存相关。** 该状态码表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件的情况。304 状态码返回时，不包含任何响应的主体部分。304 虽然被划分在 3XX 类别中，但是和重定向没有关系。

  带条件的请求（Http 条件请求）：使用 Get方法 请求，请求报文中包含（`if-match`、`if-none-match`、`if-modified-since`、`if-unmodified-since`、`if-range`）中任意首部。

  状态码304并不是一种错误，而是告诉客户端有缓存，直接使用缓存中的数据。返回页面的只有头部信息，是没有内容部分的，这样在一定程度上提高了网页的性能。

- **307 Temporary Redirect：临时重定向。** 该状态码与 302 Found 有着相同含义，尽管 302 标准禁止 POST 变成 GET，但是实际使用时还是这样做了。 307 会遵守浏览器标准，**不会从 POST 变成 GET**。但是对于处理请求的行为时，不同浏览器还是会出现不同的情况。规范要求浏览器继续向 Location 的地址 POST 内容。规范要求浏览器继续向 Location 的地址 POST 内容。

#### 3. 4XX (Client Error 客户端错误状态码)

4XX 的响应结果表明**客户端**是发生错误的原因所在。

- **400 Bad Request**：该状态码表示请求报文中存在语法错误。当错误发生时，需修改请求的内容后再次发送请求。另外，浏览器会像 200 OK 一样对待该状态码。

- **401 Unauthorized：**该状态码表示发送的请求需要有通过 HTTP 认证(BASIC 认证、DIGEST 认证)的认证信息。若之前已进行过一次请求，则表示用户认证失败 返回含有 401 的响应必须包含一个适用于被请求资源的 WWW-Authenticate 首部用以质询(challenge)用户信息。当浏览器初次接收到 401 响应，会弹出认证用的对话窗口。 


- **403 Forbidden**：该状态码表明请求资源的访问被服务器拒绝了，服务器端没有必要给出详细理由，但是可以在响应报文实体的主体中进行说明。进入该状态后，不能再继续进行验证。该访问是永久禁止的，并且与应用逻辑密切相关。 IIS 定义了许多不同的 403 错误，它们指明更为具体的错误原因。


- **404 Not Found：**该状态码表明服务器上无法找到请求的资源。除此之外，也可以在服务器端拒绝请求且不想说明理由时使用。


- **405 Method Not Allowed：**该状态码表示客户端请求的方法虽然能被服务器识别，但是服务器禁止使用该方法。 GET 和 HEAD 方法，服务器应该总是允许客户端进行访问。 客户端可以通过 OPTIONS 方法（预检）来查看服务器允许的访问方法, 如下

```javascript
Access-Control-Allow-Methods: GET,HEAD,PUT,PATCH,POST,DELETE
```

#### 4. 5XX (Server Error 服务器错误状态码)

5XX 的响应结果表明**服务器**本身发生错误.

- **500 Internal Server Error：**该状态码表明服务器端在执行请求时发生了错误。也有可能是 Web 应用存在的 bug 或某些临时的故障。

- **502 Bad Gateway：**该状态码表明扮演网关或代理角色的服务器，从上游服务器中接收到的响应是无效的 注意，502 错误通常不是客户端能够修复的，而是需要由途经的 Web 服务器或者代理服务器对其进行修复 以下情况会出现502：

  - 502.1 – CGI （通用网关接口）应用程序超时。

  - 502.2 – CGI （通用网关接口）应用程序出错。


- **503 Service Unavailable：**该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。如果事先得知解除以上状况需要的时间，最好写入 RetryAfter 首部字段再返回给客户端。 **使用场景：**

  - 服务器停机维护时，主动用503响应请求；

  - nginx 设置限速，超过限速，会返回503。


- **504 Gateway Timeout：**该状态码表示网关或者代理的服务器无法在规定的时间内获得想要的响应。他是HTTP 1.1中新加入的。 使用场景：代码执行时间超时，或者发生了死循环。



## 数字数据编码

对于数字数据编码成数字信号，有以下6种方式：

#### 1、归零编码RZ

在每一小段的时钟周期内，后半段会回到低电平的位置。

#### 2、非归零编码NRZ

高电平为1，低电平为0。
编码容易实现，但没有检错功能，且无法判断一个码元的开始和结束，以至于收发双发难以保持同步。

#### 3、反向不归零编码NRZI

信号电平翻转表示0，信号电平不变表示1。（同差分曼彻斯特编码，但无周期内的电平跳变）。

#### 4、曼彻斯特编码

将一个码元分成两个相等的间隔，前低后高表示 1 ， 0 则相反；也可以采用相反的规定。
该编码的特点是在每个码元的中间出现电平跳变，每一个码元都被调成两个电平，所以数据传输速率只有调制速率的 1 / 2 。

#### 5、差分曼彻斯特编码

信号电平在下一个时钟周期发生了翻转，则为0，否则为1。（同NRZI）
该编码的特点是在每个码元的中间也出现电平跳变，可以实现自同步；抗干扰性强于曼彻斯特编码。

#### 6、4B/5B编码

在比特流中插入额外的比特以打破一连串的0或1，就是用5个bit编码4个bit的数据，编码效率为80%。

![](https://img-blog.csdnimg.cn/a2e51276773e46b8a98470d7ab8f94cc.png)



## 对称加密算法

- 算法公开
- 计算量小
- 加密速度快
- 加密效率高
- 但加密密钥和解密密钥相同，安全性可能得不到保证



## RSA算法

RSA算法是一种公钥密码算法（非对称加密）。

#### 加密过程

$$
密文=明文^{E}modN
$$

`E` 和 `N` 是RSA机密的密钥，也就是说 `E` 和 `N` 的组合是公钥。

#### 解密过程

$$
明文=密文^{D}modN
$$

知道 `D` 和`N` 就可以解密，所以 `D` 和`N` 的组合就是私钥。

#### 生成密钥对

​	**1、求N**

​		准备两个质数p，q，不能太小，将p乘以q就是N。
$$
N = p * q
$$
​	**2、求L** （L为中间过程的中间数）

​		L是 p-1 和 q-1 的最小公倍数。
$$
L = lcm(p-1, q-1)
$$
​	**3、求E**

​		E必须满足两个条件：
$$
1<E<L\\gcd(E,L)=1
$$
​	**4、求D**

​		D、E和L之间必须满足以下关系
$$
1<D<L\\E*D modL=1
$$


## 凯撒密码加密

凯撒密码的替换方法是通过排列明文和密文字母表，密文字母表示通过**将明文字母表向左或向右移动一个固定数目**的位置。

当偏移量是左移3的时候，解密时的密钥就是3。



